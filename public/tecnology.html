<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="style/style.css">
    <link rel="stylesheet" href="style/footer.css">
    <link rel="stylesheet" href="style/adaptives.css">
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    <link rel="icon" type="image/x-icon" href="favicon.svg">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Технология</title>
</head>
<body>
    <header id="header_up">
        <div class="header_fixed_block">
            <div class="header_container">
                <div data-aos="fade-down" class="header_content_container">
                    <div class="letf_side_header">
                        <div class="logo_burger">
                            <img class="burger" src="content/burger.svg" alt="burger_icon">
                            <a href="index.html" class="logo_font">БУР СТРОЙ</a>
                        </div>
                        <nav class="navigation">
                            <ul>
                                <li><a class="opacity_change_hader" href="index.html">Главная</a></li>
                                <li><a class="orange_state" href="tecnology.html">Технологии</a></li>
                                <li><a class="opacity_change_hader" href="material.html">Материалы</a></li>
                                <li><a class="opacity_change_hader" href="portfolio.html">Портфолио</a></li>
                                <li><a class="opacity_change_hader" href="material.html#footer">Контакты</a></li>
                            </ul>
                        </nav>
                    </div>
                    <div class="right_side_header">
                        <div class="contct_container">
                            <button class="phone_contact white_color">
                                <a href="tel:+79897654565">
                                    <img src="content/phone_icon.svg" alt="phone_icon">
                                    <address>
                                        <a href="tel:+79897654565">+7 (989) 765 45 65</a>
                                    </address>
                                </a>
                            </button>
                            <button class="chat_contact">
                                <img src="content/chat_icon.svg" alt="chat_icon">
                                <p>Написать</p>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            <div  class="mobile_header_navigation">
                <div class="content_mobile_navigation">
                    <button class="close_mobile_navigation">
                        <span>
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">
                                <path stroke-linecap="round" stroke-linejoin="round" d="m9.75 9.75 4.5 4.5m0-4.5-4.5 4.5M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" />
                            </svg>
                        </span>
                    </button>
                    <nav class="navigation_mobile">
                        <ul>
                                <li><a class="opacity_change_hader" href="index.html">Главная</a></li>
                                <li><a class="orange_state" href="tecnology.html">Технологии</a></li>
                                <li><a class="opacity_change_hader" href="material.html">Материалы</a></li>
                                <li><a class="opacity_change_hader" href="portfolio.html">Портфолио</a></li>
                                <li><a class="opacity_change_hader" href="#footer">Контакты</a></li>
                            </ul>
                    </nav>
                </div>
            </div>
        </div>
    </header>
    <main>
        <div class="first_block_article">
            <div class="article_container_">
                <div  data-aos="zoom-in" class="title_block_article qfekjwkjefljqwef">
                    <h4 class="titile_bloks__">Наши технологии</h4>
                    <form class="form">
                        <button type="submit">
                            <svg width="17" height="16" fill="none" xmlns="http://www.w3.org/2000/svg" role="img" aria-labelledby="search">
                                <path d="M7.667 12.667A5.333 5.333 0 107.667 2a5.333 5.333 0 000 10.667zM14.334 14l-2.9-2.9" stroke="currentColor" stroke-width="1.333" stroke-linecap="round" stroke-linejoin="round"></path>
                            </svg>
                        </button>
                        <input class="input" placeholder="Поиск статей" type="text">
                        <button class="search_article" type="submit">поиск</button>
                    </form>
                </div>
                <div class="line_under_title"></div>
                <div class="controll_">
                    <div class="controll_title">
                        <h3>Контроль качества</h3>
                        <img src="content/shield.svg" alt="shield_icon">
                    </div>
                    <p>Испытания грунтов с использованием буронабивных свай играют ключевую роль в обеспечении прочности и стабильности строительных конструкций. Этот метод помогает определить механические свойства грунта, его несущую способность и реакцию на внешние нагрузки с высокой точностью.</p>
                </div>
                <div class="main_states_tecnology">
                    <div class="container_main-tecnolofy">
                        <a href="#">
                            <img src="content/example_img_for_article.png" alt="main_tecnology">
                            <div class="text_block_ofarticles">
                                <h3>Замер уширения свай термометрический методом TIP</h3>
                            </div>
                        </a>
                        <a href="#">
                            <img src="content/example_img_for_article.png" alt="main_tecnology">
                            <div class="text_block_ofarticles">
                                <h3>Замер уширения свай термометрический методом TIP</h3>
                            </div>
                        </a>
                        <a href="#">
                            <img src="content/example_img_for_article.png" alt="main_tecnology">
                            <div class="text_block_ofarticles">
                                <h3>Замер уширения свай термометрический методом TIP</h3>
                            </div>
                        </a>
                    </div>
                </div>
                <div class="line_under_title"></div>
                <div class="grid_block_for_states">
                    <div class="grid_container">
                    </div>
                    <center class="rgwreger">
                        <button id="more_button">Загрузить еще</button>
                    </center>
                </div>
            </div>
        </div>
    </main>
    <footer id="footer">
        <div class="dop_information_under_footer">
            <div class="dop_footer_container">
                <div class="text_content_container">
                    <p data-aos="zoom-in-down">гарантирует качественное устройство буронабивных свай</p>  
                    <h3 data-aos="zoom-out-down">Ваш надежный партнер в <span style="color: #FF8B3A !important;">буронабивных сваях.</span><br> Доверьтесь профессионалам</h3>
                    <button id="footer_button" data-aos="fade-up" data-aos-duration="1000">Оставить заявку<img src="content/arrow_for_button_footer.svg" alt="arrow_footer"></button>
                </div>
            </div>
        </div>
        <div class="footer_container">
            <div class="footer_content">
                <div class="up_line_content">
                    <div data-aos="fade-right" class="lfsifooter">
                        <div class="titlefooter_text">
                            <h3><span class="orange_statee">Бур</span> Строй Ком</h3>
                            <p>Только  жесткий контроль на каждом <br> этапе – это наш стандарт для вашей <br> надежной опоры.</p>
                        </div>
                        <div class="mini_navigatio">
                            <nav class="navigation_mini">
                                <ul class="opacity_change_footer">
                                    <li><a  href="#header_up">Главная</a></li>
                                    <li><a style="color: #FF8B3A !important;" href="tecnology.html">Технологии</a></li>
                                    <li><a  href="material.html">Материалы</a></li>
                                    <li><a href="portfolio.html">Портфолио</a></li>
                                </ul>
                            </nav>
                        </div>
                    </div>
                    <div data-aos="fade-left" class="rhsifooter">
                        <a class="up_link" href="#">На вверх <img src="content/arrow_footer.svg" alt="arrow"></a>
                        <address class="footer_address">
                            <a href="tel:+78005553535">Телефон - +8 (800) 555 35 - 35</a>
                            <a href="mailto:bursroy@gmail.com">Почта - bursroy@gmail.com</a>
                        </address>
                        <a href="#">Политика конфиденциальности</a>
                    </div>
                </div>
                <div class="line_white"></div>
                <div class="down_line_content">
                    <p>© 2025 Все права защищены</p>
                     <a href="https://t.me/pparhaty"><p>&copy; 2024 Pakhomets Nikita Sergeevich</p></a>
                </div>
            </div>
        </div>
    </footer>
    <script src="script/script.js"></script>
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    <script src="script/smooth-page-transition.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
    const containerArticle = document.querySelector('.grid_container');
    const loadMoreButton = document.querySelector('#more_button');
    const searchForm = document.querySelector('.form');
    const searchInput = document.querySelector('.input');
    let allArticles = [];
    let displayedArticles = 12; // Начальное количество статей
    const articlesPerLoad = 12; // Количество статей для подгрузки

    if (!containerArticle) {
        console.error('Контейнер .grid_container не найден в HTML');
        return;
    }

    async function loadJSON() {
        try {
            const response = await fetch('/data_article.json');
            if (!response.ok) throw new Error(`Не удалось загрузить JSON: ${response.status}`);
            const data = await response.json();
            console.log('JSON данные:', data);
            return data;
        } catch (error) {
            console.error('Ошибка при загрузке JSON:', error);
            return [];
        }
    }

    async function getFirstImageFromArticle(articleId) {
        try {
            const response = await fetch(`articles/${articleId}.html`);
            if (!response.ok) throw new Error(`Не удалось загрузить статью: ${response.status}`);
            const htmlContent = await response.text();
            
            const parser = new DOMParser();
            const doc = parser.parseFromString(htmlContent, 'text/html');
            
            // Список иконок, которые нужно игнорировать
            const ignoredImages = ['burger.svg', 'phone_icon.svg', 'chat_icon.svg'];
            
            // Ищем все теги <img> в статье
            const imgElements = doc.querySelectorAll('img');
            
            // Находим первое изображение, чей src не содержит игнорируемые имена
            const imgElement = Array.from(imgElements).find(img => {
                const src = img.src.toLowerCase();
                return !ignoredImages.some(ignored => src.includes(ignored));
            });
            
            const imageSrc = imgElement ? imgElement.src : 'content/example_img_for_article.png';
            console.log(`Изображение для статьи ${articleId}: ${imageSrc}`);
            return imageSrc;
        } catch (error) {
            console.error(`Ошибка при загрузке изображения для статьи ${articleId}:`, error);
            return 'content/example_img_for_article.png';
        }
    }

    async function createArticleElement(article) {
        const image = await getFirstImageFromArticle(article.id); // Загружаем первое изображение из HTML статьи

        const textElement = article.content.elements.find(element => element.type === 'text');
        const description = textElement ? textElement.value.split('\n')[0] : 'Описание отсутствует';

        const articleLink = `articles/${article.id}.html`;

        return `
            <div class="grid_item">
                <div class="item_content_container">
                    <div class="img_articles_links">
                        <img src="${image}" onerror="this.src='content/example_img_for_article.png'" alt="article_img">
                    </div>
                    <div class="text_block_for_item_grid">
                        <h3>${article.title.substring(0, 50)}...</h3>
                        <h4>${description}</h4>
                    </div>
                    <div class="button_contiioerfnireog">
                        <button class="link_on_articles" onclick="window.location.href='${articleLink}'">Читать<img src="content/book_icon.svg" alt="book_icon"></button>
                    </div>
                </div>
            </div>
        `;
    }

    function calculateRelevance(article, query) {
        const normalizedQuery = query.toLowerCase().trim();
        const title = article.title.toLowerCase();
        const textElement = article.content.elements.find(element => element.type === 'text');
        const description = textElement ? textElement.value.toLowerCase() : '';
        
        let score = 0;
        if (title.includes(normalizedQuery)) score += 2;
        if (description.includes(normalizedQuery)) score += 1;
        return score;
    }

    async function displayArticles(searchQuery = '') {
        if (!allArticles.length) {
            allArticles = await loadJSON();
        }

        if (!allArticles || !Array.isArray(allArticles)) {
            console.error('Данные не загружены или не являются массивом');
            containerArticle.innerHTML = '<p>Ошибка загрузки статей</p>';
            loadMoreButton.style.display = 'none';
            return;
        }

        containerArticle.innerHTML = ''; // Очищаем контейнер перед отображением

        // Фильтруем статьи, где checkbox === true
        let articlesToDisplay = allArticles.filter(article => article.checkbox === true);

        if (searchQuery) {
            articlesToDisplay.sort((a, b) => {
                const scoreA = calculateRelevance(a, searchQuery);
                const scoreB = calculateRelevance(b, searchQuery);
                return scoreB - scoreA; // Сортировка по убыванию релевантности
            });

            if (articlesToDisplay.every(article => calculateRelevance(article, searchQuery) === 0)) {
                containerArticle.innerHTML = '<p>По вашему запросу ничего не найдено</p>';
                loadMoreButton.style.display = 'none';
                return;
            }
        }

        // Отображаем только до displayedArticles
        for (const article of articlesToDisplay.slice(0, displayedArticles)) {
            const itemArticle = await createArticleElement(article);
            containerArticle.insertAdjacentHTML('beforeend', itemArticle);
        }

        // Показываем/скрываем кнопку "Загрузить еще"
        loadMoreButton.style.display = displayedArticles >= articlesToDisplay.length ? 'none' : 'block';
    }

    // Обработчик кнопки "Загрузить еще"
    loadMoreButton.addEventListener('click', () => {
        displayedArticles += articlesPerLoad;
        displayArticles(searchInput.value.trim());
    });

    // Обработчик поиска
    searchForm.addEventListener('submit', (e) => {
        e.preventDefault();
        displayedArticles = 12; // Сбрасываем до начального количества
        displayArticles(searchInput.value.trim());
    });

    // Начальная загрузка
    displayArticles();

    AOS.init();
});
    </script>
</body>
</html>